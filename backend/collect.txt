============================= test session starts =============================
platform win32 -- Python 3.14.0, pytest-9.0.2, pluggy-1.6.0
rootdir: C:\Users\aibra\.gemini\antigravity\scratch\Wafaa-Project\backend
configfile: pyproject.toml
testpaths: tests
plugins: anyio-4.12.0, asyncio-1.3.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 137 items / 1 error

<Dir backend>
  <Package tests>
    <Module test_agent_analytics_api.py>
      <Class TestSentimentEndpoint>
        <Function test_get_sentiment_success>
        <Function test_get_sentiment_with_data>
        <Function test_get_sentiment_requires_auth>
        <Function test_get_sentiment_custom_period>
      <Class TestResponseTimeEndpoint>
        <Function test_get_response_time_success>
        <Function test_get_response_time_with_data>
        <Function test_get_response_time_requires_auth>
      <Class TestConversationEndpoint>
        <Function test_get_conversations_success>
        <Function test_get_conversations_with_data>
        <Function test_get_conversations_requires_auth>
      <Class TestInsightsEndpoint>
        <Function test_get_insights_success>
        <Function test_get_insights_requires_auth>
      <Class TestAgentAnalyticsTenantIsolation>
        <Function test_sentiment_tenant_isolated>
    <Module test_analytics_api.py>
      <Class TestAnalyticsOverview>
        <Function test_get_overview_success>
        <Function test_get_overview_requires_auth>
      <Class TestAnalyticsConversations>
        <Function test_get_conversation_trends>
        <Function test_get_conversation_trends_custom_period>
        <Function test_get_conversation_trends_invalid_period>
      <Class TestAnalyticsMessages>
        <Function test_get_message_trends>
      <Class TestAnalyticsChannels>
        <Function test_get_channel_performance>
      <Class TestAnalyticsTenantIsolation>
        <Function test_analytics_tenant_isolated>
    <Module test_auth.py>
      <Function test_login_success>
      <Function test_login_wrong_password>
      <Function test_login_nonexistent_email>
      <Function test_login_inactive_user>
      <Function test_login_inactive_tenant>
      <Function test_login_updates_last_login>
      <Function test_refresh_success>
      <Function test_refresh_with_access_token_fails>
      <Function test_refresh_with_invalid_token>
      <Function test_refresh_with_expired_token>
      <Function test_logout_invalidates_token>
      <Function test_protected_endpoint_no_token>
    <Module test_channels_api.py>
      <Class TestChannelCreate>
        <Function test_create_whatsapp_channel>
        <Function test_create_instagram_channel>
        <Function test_create_channel_requires_auth>
        <Function test_create_duplicate_channel_type>
      <Class TestChannelList>
        <Function test_list_channels>
      <Class TestChannelUpdate>
        <Function test_update_channel>
        <Function test_update_nonexistent_channel>
      <Class TestChannelDelete>
        <Function test_delete_channel>
      <Class TestChannelTenantIsolation>
        <Function test_channel_isolated_between_tenants>
    <Module test_chat_api.py>
      <Class TestChatEndpoint>
        <Function test_chat_requires_auth>
        <Function test_chat_empty_message>
        <Function test_chat_with_empty_knowledge_base>
        <Function test_chat_with_knowledge>
      <Class TestChatTenantIsolation>
        <Function test_chat_isolated_between_tenants>
    <Module test_document_processor.py>
      <Class TestTxtExtraction>
        <Function test_extract_txt>
        <Function test_extract_empty_txt>
      <Class TestCsvExtraction>
        <Function test_extract_csv>
        <Function test_extract_empty_csv>
      <Class TestJsonExtraction>
        <Function test_extract_json>
      <Class TestUnsupportedType>
        <Function test_unsupported_raises_error>
      <Class TestPdfExtraction>
        <Function test_pdf_import_error>
      <Class TestDocxExtraction>
        <Function test_docx_import_error>
    <Module test_embeddings.py>
      <Function test_mock_embedding_returns_correct_dimensions>
      <Function test_mock_embedding_batch>
      <Function test_mock_embedding_deterministic>
      <Function test_mock_embedding_different_texts_differ>
      <Function test_mock_embedding_values_normalized>
      <Function test_query_embedding_convenience>
    <Module test_health.py>
      <Function test_root_health_check>
      <Function test_api_health_check>
      <Function test_db_health_check>
    <Module test_instagram_webhook.py>
      <Class TestInstagramWebhookVerification>
        <Function test_verify_webhook_success>
        <Function test_verify_webhook_wrong_token>
      <Class TestInstagramWebhookReceive>
        <Function test_receive_empty_payload>
      <Class TestInstagramSignatureVerification>
        <Function test_verify_signature>
      <Class TestInstagramPayloadParsing>
        <Function test_parse_text_message>
        <Function test_parse_empty_payload>
    <Module test_intent_classifier.py>
      <Class TestClassifyIntent>
        <Function test_greeting>
        <Function test_question>
        <Function test_complaint>
        <Function test_feedback>
        <Function test_order_inquiry>
        <Function test_other_fallback>
        <Function test_case_insensitivity>
        <Function test_empty_string>
        <Function test_whitespace_only>
        <Function test_priority_order>
    <Module test_knowledge_api.py>
      <Class TestKnowledgeUpload>
        <Function test_upload_txt_document>
        <Function test_upload_invalid_file_type>
        <Function test_upload_requires_auth>
      <Class TestKnowledgeList>
        <Function test_list_empty>
        <Function test_list_with_documents>
        <Function test_list_pagination>
      <Class TestKnowledgeGet>
        <Function test_get_document>
        <Function test_get_document_not_found>
      <Class TestKnowledgeDelete>
        <Function test_delete_document>
        <Function test_delete_not_found>
      <Class TestKnowledgeTenantIsolation>
        <Function test_cannot_see_other_tenant_documents>
        <Function test_cannot_delete_other_tenant_document>
    <Module test_rag_engine.py>
      <Class TestRetrieveContext>
        <Function test_retrieve_empty_knowledge_base>
        <Function test_retrieve_with_chunks>
      <Class TestBuildRagPrompt>
        <Function test_empty_context>
        <Function test_with_context>
      <Class TestRagQuery>
        <Function test_query_empty_knowledge_base>
        <Function test_query_with_knowledge>
      <Class TestRagTenantIsolation>
        <Function test_cannot_retrieve_other_tenant_chunks>
    <Module test_tenant_isolation.py>
      <Function test_tenant_a_cannot_see_tenant_b_details>
      <Function test_tenant_a_cannot_list_tenant_b_admins>
      <Function test_created_admin_belongs_to_correct_tenant>
      <Function test_tenant_b_cannot_update_tenant_a>
      <Function test_login_tokens_are_tenant_scoped>
    <Module test_tenants.py>
      <Function test_get_current_tenant>
      <Function test_update_tenant_name>
      <Function test_update_tenant_settings>
      <Function test_update_tenant_viewer_forbidden>
      <Function test_list_admins>
      <Function test_create_admin>
      <Function test_create_admin_duplicate_email>
      <Function test_create_admin_viewer_forbidden>
      <Function test_create_admin_short_password>
    <Module test_text_chunker.py>
      <Function test_empty_input>
      <Function test_single_short_sentence>
      <Function test_chunks_respect_size_limit>
      <Function test_chunks_have_sequential_indices>
      <Function test_overlap_creates_shared_content>
      <Function test_large_single_sentence>
      <Function test_paragraph_splitting>
      <Function test_token_count_matches_word_count>
    <Module test_vector_store.py>
      <Function test_upsert_and_query>
      <Function test_query_respects_top_k>
      <Function test_tenant_isolation>
      <Function test_delete_vectors>
      <Function test_delete_vectors_by_document>
      <Function test_empty_query_returns_empty>
    <Module test_whatsapp_webhook.py>
      <Class TestWhatsAppWebhookVerification>
        <Function test_verify_webhook_success>
        <Function test_verify_webhook_wrong_token>
        <Function test_verify_webhook_missing_params>
      <Class TestWhatsAppWebhookReceive>
        <Function test_receive_empty_payload>
        <Function test_receive_status_update>
      <Class TestSignatureVerification>
        <Function test_verify_signature>
        <Function test_verify_signature_invalid>
        <Function test_verify_signature_wrong_prefix>
      <Class TestPayloadParsing>
        <Function test_parse_text_message>
        <Function test_parse_empty_payload>

=================================== ERRORS ====================================
______________ ERROR collecting tests/test_sentiment_analyzer.py ______________
ImportError while importing test module 'C:\Users\aibra\.gemini\antigravity\scratch\Wafaa-Project\backend\tests\test_sentiment_analyzer.py'.
Hint: make sure your test modules/packages have valid Python names.
Traceback:
C:\Users\aibra\AppData\Local\Programs\Python\Python314\Lib\importlib\__init__.py:88: in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
tests\test_sentiment_analyzer.py:3: in <module>
    from app.services.sentiment_analyzer import analyze_sentiment
app\services\sentiment_analyzer.py:7: in <module>
    from vaderSentiment.vaderSentiment import SentimentIntensityAnalyzer
E   ModuleNotFoundError: No module named 'vaderSentiment'
=========================== short test summary info ===========================
ERROR tests/test_sentiment_analyzer.py
!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!
==================== 137 tests collected, 1 error in 0.70s ====================

STDERR:
